// Wave configuration for cross-platform container handling
wave {
    enabled = true
    strategy = ['conda']
    freeze = true
}

params {
    species = 'K_pneumoniae'

    // Workflow instructions
    run_analysis = true

    // Input data paths
    genomes = "${projectDir}/../${params.species}/ncbi_dataset/data/*/*.fna"
    roll = "${projectDir}/data/genomes/${params.species}.csv"
    pangenome_ref = null
    
    // Numeric parameters
    window = 25
    thresh_value = 1.4
    
    // Script paths
    g4script = "${projectDir}/scripts/main.py"
    g4dataproc = "${projectDir}/scripts/secondary.py"
    g4mergenappend = "${projectDir}/scripts/g4mergenappend.py"
    g4hunter2bed = "${projectDir}/scripts/g4hunter2bed.py"
    analysisscript = "${projectDir}/scripts/data_analysis/data_analysis.R"
    addsequence = "${projectDir}/scripts/data_analysis/add_sequence.py"

    // Output directory
    outdir = "results"
    pangenome_path = "${projectDir}/pangenome_reference"
    generate_pangenome = false
    auto_discover = true
}

// Profiles for different environments
profiles {
        // Default profile - will be used if no profile is specified
    standard {
        process.executor = 'local'
        docker.enabled = true
        singularity.enabled = false
        
        process {
            cpus = 1
            memory = 4.GB
        }
    }
    
    // MacOS/Local development profile
    mac {
        process.executor = 'local'
        docker.enabled = true
        singularity.enabled = false
        
        process {
            cpus = 1
            memory = 4.GB
        }
    }
    
    // HPC profile with Singularity
    hpc {
        process.executor = 'slurm'
        docker.enabled = false
        singularity.enabled = true
        singularity.autoMounts = true
        singularity.cacheDir = '/shared/singularity/cache'
        
        process {
            queue = 'your-queue-name'
            cpus = 8
            memory = 16.GB
            time = '4h'
            
            resourceLimits = [
                memory: 750.GB,
                cpus: 200,
                time: 30.d
            ]
        }
    }
}

process {
    cache = 'lenient'
    cpus = 1
    memory = 4.GB
    time = '2h'

    // Process labels for resource allocation
    withLabel: 'process_low' {
        cpus = 1
        memory = 2.GB
        time = '1h'
    }
    
    withLabel: 'process_medium' {
        cpus = 2
        memory = 4.GB
        time = '2h'
    }

    withLabel: 'process_high' {
        cpus = 4
        memory = 4.GB
        time = '2h'
    }
    
    // Modular process names
    withName: 'G4HUNTER' {
        conda = "${projectDir}/environments/g4hunter_env.yml"
    }

    withName: 'MERGE_SUMMARIES' {
        conda = "${projectDir}/environments/python_env.yml"
    }

    withName: 'COMBINE_GFF_FASTA' {
        conda = "${projectDir}/environments/python_env.yml"
    }

    withName: 'CLUSTER_GENES' {
        conda = "${projectDir}/environments/roary_env.yml"
    }

    withName: 'PLOTTING'{
        conda = "${projectDir}/environments/data_analysis_env.yml"
    }
}

// Add Manifest????????????